/*! inline-attach - v1.3.1 - 2014-09-21 */
(function(e,t){"use strict";function n(){for(var e={},t=arguments.length-1;t>=0;t--){var n=arguments[t];for(var a in n)e[a]=n[a]}return e}t.inlineAttach=function(e,a){function r(e,t){return(e+"\n\n[[D]]"+t).replace(/(\n{2,})\[\[D\]\]/,"\n\n").replace(/^(\n*)/,"")}var o,i=n(e,inlineAttach.defaults),l=a,s="{filename}",u=this;this.uploadFile=function(e){var t=new FormData,n=new XMLHttpRequest,a="png";if(e.name){var r=e.name.match(/\.(.+)$/);r&&(a=r[1])}if(t.append(i.uploadFieldName,e,"image-"+Date.now()+"."+a),"object"==typeof i.extraParams)for(var o in i.extraParams)i.extraParams.hasOwnProperty(o)&&t.append(o,i.extraParams[o]);if(n.open("POST",i.uploadUrl),"object"==typeof i.extraHeaders)for(var l in i.extraHeaders)i.extraHeaders.hasOwnProperty(l)&&n.setRequestHeader(l,i.extraHeaders[l]);n.onload=function(){if(200===n.status||201===n.status){var e=JSON.parse(n.responseText);u.onUploadedFile(e)}else u.onErrorUploading()},n.send(t)},this.isAllowedFile=function(e){return i.allowedTypes.indexOf(e.type)>=0},this.onUploadedFile=function(e){var t,n=i.onUploadedFile(e);if(i.dataProcessor&&(e=i.dataProcessor(e)),t=e[i.downloadFieldName],n!==!1&&t){var a=l.getValue().replace(o,i.urlText.replace(s,t));l.setValue(a)}},this.customUploadHandler=function(e){return i.customUploadHandler(e)},this.onErrorUploading=function(){var e=l.getValue().replace(o,"");l.setValue(e),i.customErrorHandler()&&t.alert(i.errorText)},this.onReceivedFile=function(e){var t=i.onReceivedFile(e);t!==!1&&(o=i.progressText,l.setValue(r(l.getValue(),o)))},this.onPaste=function(e){var t,n=!1,a=e.clipboardData;if("object"==typeof a){t=a.items||a.files||[];for(var r=0;t.length>r;r++){var o=t[r];u.isAllowedFile(o)&&(n=!0,this.onReceivedFile(o.getAsFile()),this.customUploadHandler(o.getAsFile())&&this.uploadFile(o.getAsFile()))}}return n},this.onDrop=function(e){for(var t=!1,n=0;e.dataTransfer.files.length>n;n++){var a=e.dataTransfer.files[n];u.isAllowedFile(a)&&(t=!0,this.onReceivedFile(a),this.customUploadHandler(a)&&this.uploadFile(a))}return t}},t.inlineAttach.Editor=function(e){var t=e;return{getValue:function(){return t.value},setValue:function(e){t.value=e}}},t.inlineAttach.defaults={uploadUrl:"upload_attachment.php",uploadFieldName:"file",downloadFieldName:"filename",allowedTypes:["image/jpeg","image/png","image/jpg","image/gif"],progressText:"![Uploading file...]()",urlText:"![file]({filename})",errorText:"Error uploading file",extraParams:{},extraHeaders:{},onReceivedFile:function(){},customUploadHandler:function(){return!0},customErrorHandler:function(){return!0},onUploadedFile:function(){}},t.inlineAttach.attachToInput=function(e,t){t=t||{};var n=new inlineAttach.Editor(e),a=new inlineAttach(t,n);e.addEventListener("paste",function(e){a.onPaste(e)},!1),e.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),a.onDrop(e)},!1),e.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1)}})(document,window),function(e,t){"use strict";function n(e){if(!e.getWrapperElement)throw"Invalid CodeMirror object given";var t=e;return{getValue:function(){return t.getValue()},setValue:function(e){var n=t.getCursor();t.setValue(e),t.setCursor(n)}}}n.prototype=new inlineAttach.Editor,t.inlineAttach.attachToCodeMirror=function(e,t){t=t||{};var a=new n(e),r=new inlineAttach(t,a),o=e.getWrapperElement();o.addEventListener("paste",function(e){r.onPaste(e)},!1),e.setOption("onDragEvent",function(e,t){return"drop"===t.type?(t.stopPropagation(),t.preventDefault(),r.onDrop(t)):void 0})}}(document,window);